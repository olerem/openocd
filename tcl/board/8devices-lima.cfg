source [find target/qualcomm_qca4531.cfg]

#reset_config srst_only srst_pulls_trst
#reset_config srst_only
reset_config none

# For ETH part the rest should be asserted at least for 10ms
# Since there is no other information let's take 100ms to be sure.
adapter_nsrst_assert_width 100
# according documentation it should take at least 5ms from
# reset end till bootstrap end. In the practice we need 8ms
# to get JTAG back to live.
adapter_nsrst_delay 8

proc qca4531_ddr2_550_550_init {} {
	mips_m4k cp0 13 0 0x0
	mips_m4k cp0 12 0 0x0
	mips_m4k cp0 14 0 0x0
	#mips_m4k cp0 16 1 0x8024848

	mww 0xb806001c 0xfeceffff
	mww 0xb806001c 0xeeceffff
	mww 0xb806001c 0xe6ceffff
	mww 0xb8116c40 0x633c8176
	mww 0xb8116c44 0x10200000
	mww 0xb81162c0 0x4b962100
	mww 0xb81162c4 0x480
	mww 0xb81162c8 0x04000144
	mww 0xb81161c4 0x54086000
	mww 0xb8116244 0x54086000
	mww 0xb8050008 0x0131001c
	mww 0xb8050000 0x40001580
	mww 0xb8050004 0x40015800
	mww 0xb8050008 0x0131001c
	mww 0xb8050000 0x00001580
	mww 0xb8050004 0x00015800
	mww 0xb8050008 0x01310000
	mww 0xb8050044 0x781003ff
	mww 0xb8050048 0x003c103f
	mww 0xb8000108 0x401f0042
	mww 0xb80000b8 0x0000166d
	mww 0xb8000000 0xcfaaf33b
	mww 0xb800015c 0x0000000f
	mww 0xb8000004 0xa272efa8
	mww 0xb8000018 0x000ffff
	mww 0xb80000c4 0x74444444
	mww 0xb80000c8 0x00000444
	mww 0xb8000004 0xa210ee28
	mww 0xb8000004 0xa2b2e1a8
	mww 0xb8000010 0x8
	mww 0xb80000bc 0x0
	mww 0xb8000010 0x10
	mww 0xb80000c0 0x0
	mww 0xb8000010 0x40 
	mww 0xb800000c 0x2
	mww 0xb8000010 0x2
	mww 0xb8000008 0xb43
	mww 0xb8000010 0x1
	mww 0xb8000010 0x8
	mww 0xb8000010 0x4
	mww 0xb8000010 0x4
	mww 0xb8000008 0xa43
	mww 0xb8000010 0x1
	mww 0xb800000c 0x382
	mww 0xb8000010 0x2
	mww 0xb800000c 0x402
	mww 0xb8000010 0x2
	mww 0xb8000014 0x40be
	mww 0xb800001C 0x20
	mww 0xb8000020 0x20
	mww 0xb80000cc 0xfffff
	mww 0xb8040000 0xff30b
	mww 0xb8040044 0x908
	mww 0xb8040034 0x160000
}

$_TARGETNAME configure -event reset-init {
	qca4531_ddr2_550_550_init
}

$_TARGETNAME configure -event reset-assert-pre {
	halt
	mww 0xb806000c 0x3000
	mww 0xb8060008 0x3
	#mww 0xb806001C 0x11010000
	sleep 50
}

set ram_boot_address 0xa0000000
$_TARGETNAME configure -work-area-phys 0xa1FFE000 -work-area-size 0x1000

flash bank flash0 ath79 0 0 0 0 $_TARGETNAME cs0
