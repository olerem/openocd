source [find target/atheros_ar9344.cfg]

reset_config trst_only separate

proc ar9344_40mhz_pll_init {} {
	mww 0xb81161C4 0x13210f00
	mww 0xb81161C8 0x03000000
	mww 0xb8116244 0x13210f00
	mww 0xb8116248 0x03000000
	mww 0xb8116188 0x03000000

	mww 0xb8050008 0x0130001C
	mww 0xb8050008 0x0130001C
	mww 0xb8050008 0x0130001C

	mww 0xb8050000 0x40021380
	mww 0xb8050004 0x40815800
	mww 0xb8050008 0x0130801C

	mww 0xb81161C4 0x10810F00
	mww 0xb81161C0 0x41C00000
	mww 0xb81161C4 0xD0810F00
	mww 0xb81161C8 0x03000000
	mww 0xb81161C4 0xD0800F00

	mww 0xb81161C8 0x03000000
	mww 0xb81161C8 0x43000000
	mww 0xb81161C8 0x030003E8

	mww 0xb8116244 0x10810F00
	mww 0xb8116240 0x41680000
	mww 0xb8116244 0xD0810F00
	mww 0xb8116248 0x03000000
	mww 0xb8116244 0xD0800F00

	mww 0xb8116248 0x03000000
	mww 0xb8116248 0x43000000
	mww 0xb8116248 0x03000718

	mww 0xb8050008 0x01308018
	mww 0xb8050008 0x01308010
	mww 0xb8050008 0x01308000
	mww 0xb8050044 0x78180200
	mww 0xb8050048 0x41C00000

}

proc ar9344_ddr_init {} {
	mww 0xb8000108 0x40
	mww 0xb8000018 0xFF
	mww 0xb80000C4 0x74444444
	mww 0xb80000C8 0x0222
	mww 0xb80000CC 0xFFFFF

	mww 0xb8000000 0xC7D48CD0
	mww 0xb8000004 0x9DD0E6A8

	mww 0xb80000B8 0x0E59
	mww 0xb8000004 0x9DD0E6A8

	mww 0xb8000010 0x08
	mww 0xb8000010 0x08
	mww 0xb8000010 0x10
	mww 0xb8000010 0x20
	mww 0xb800000C 0x02
	mww 0xb8000010 0x02

	mww 0xb8000008 0x0133
	mww 0xb8000010 0x1
	mww 0xb8000010 0x8
	mww 0xb8000010 0x8
	mww 0xb8000010 0x4
	mww 0xb8000010 0x4

	mww 0xb8000008 0x33
	mww 0xb8000010 0x1

	mww 0xb800000C 0x0382
	mww 0xb8000010 0x2
	mww 0xb800000C 0x0402
	mww 0xb8000010 0x2

	mww 0xb8000014 0x4270

	mww 0xb800001C 0x0e
	mww 0xb8000020 0x0e
	mww 0xb8000024 0x0e
	mww 0xb8000028 0x0e
}

$_TARGETNAME configure -event reset-init {

	ar9344_40mhz_pll_init
	sleep 100

	# flash remap
	mww 0xbF000004 0x43

	ar9344_ddr_init
	sleep 100
}

set ram_boot_address 0xa0000000
$_TARGETNAME configure -work-area-phys 0xa1FFE000 -work-area-size 0x1000
